add_rules("mode.debug", "mode.release")

add_requires("nlohmann_json", "cpp-httplib", "boost", "openssl3", "vcpkg::webview2")
add_requireconfs("cpp-httplib", {configs = {ssl = true}})
add_requireconfs("boost", {configs = {all = true, header_only = true}})
add_requireconfs("*", {configs = {vs_runtime = "MD"}})

target("MSLogin")
    set_kind("shared")
    set_languages("clatest", "cxxlatest")
    add_files("src/**.cpp")
    add_includedirs("src", {public = true})
    add_packages("nlohmann_json", "cpp-httplib", "boost", "openssl3", "vcpkg::webview2", {public = true})
    add_defines("WIN32_LEAN_AND_MEAN", "NOMINMAX", "MSLOGIN_EXPORTS")
    add_syslinks("gdi32.lib")
    after_build(function (target)
        os.cp("$(scriptdir)/src/webscript/browser_automation.js", target:targetdir())
    end)

target("example")
    set_kind("binary")
    set_languages("clatest", "cxxlatest")
    add_files("tests/**.cpp")
    add_includedirs("src")
    add_deps("MSLogin")
    set_default(false)
    